<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>974DR ‚Äî Calcul mental</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0e0f12">
  <style>
    :root{ --bg:#0e0f12; --card:#171a21; --text:#e8ecf1; --muted:#aab3bd; --accent:#ffd166; --ok:#34d399; --bad:#f87171; --border:rgba(255,255,255,.1); }
    html,body{height:100%; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

    .wrap{max-width:980px;margin:28px auto 64px;padding:0 16px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    header .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#4aa7ff,#9b72ff);display:grid;place-items:center}
    header .logo span{font-weight:800;color:white;font-size:20px}
    h1{margin:0;font-size:clamp(22px,4vw,34px)}
    .sub{color:var(--muted);font-size:14px}

    .banner{background:linear-gradient(135deg,#4aa7ff,#8dd0ff);color:#03111f;font-weight:bold;
      padding:8px 14px;border-radius:10px;margin-bottom:16px;text-align:center}

    .card{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:14px;padding:16px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:16px}
    @media (max-width:850px){.grid{grid-template-columns:1fr}}

    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:#0f1218}
    .tables{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:8px;margin-top:6px}

    input[type="number"]{background:#0f1218;border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:var(--text);width:90px}
    button{appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;
      background:linear-gradient(135deg,#4aa7ff,#8dd0ff);color:#03111f}
    button.secondary{background:transparent;color:var(--text);border:1px solid var(--border)}

    .question{font-size:clamp(28px,6vw,56px);font-weight:800;text-align:center;margin:10px 0 6px}
    .question .op{color:var(--accent)}
    .input-line{display:flex;gap:10px;justify-content:center;align-items:center}
    .input-line input{font-size:22px;text-align:center;width:180px}
    .status{display:flex;gap:10px;justify-content:space-between;border-top:1px dashed var(--border);padding-top:10px;margin-top:10px;color:var(--muted)}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#0f1218}
    .pill.ok{border-color:rgba(52,211,153,.4);color:#d1fae5}
    .pill.bad{border-color:rgba(248,113,113,.4);color:#fee2e2}
    .feedback{min-height:26px;text-align:center;font-weight:800;margin-top:6px}
    .feedback.ok{color:var(--ok)} .feedback.bad{color:var(--bad)}
    .result{display:none} .result.active{display:block}

    /* ===== Intro plein-√©cran ===== */
    #intro{
      position:fixed; inset:0; z-index:9999;
      background:radial-gradient(1200px 800px at 30% -10%, #1b2330 0%, #0c0e12 60%);
      display:grid; place-items:center; opacity:1; transition:opacity .6s ease; pointer-events:auto;
    }
    #intro.hide{ opacity:0; pointer-events:none; }
    .intro-center{ text-align:center; padding:24px; }
    .intro-logo{
      font-weight:900; letter-spacing:2px; font-size:clamp(36px, 12vw, 96px);
      background:linear-gradient(135deg,#8dd0ff,#9b72ff);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .intro-sub{ color:#c9d6e2; margin:6px 0 16px; font-size:clamp(14px,3.5vw,18px); opacity:.9 }
    .intro-heart{ font-size:22px; color:#ff4d4d; font-weight:800; margin-bottom:14px; }
    .intro-btn{border:none;border-radius:14px;padding:12px 18px;font-weight:800;cursor:pointer;
      background:linear-gradient(135deg,#4aa7ff,#8dd0ff);color:#03111f;margin-top:14px;}
  </style>
</head>
<body>

  <!-- Intro -->
<div id="intro" aria-hidden="true">
  <div class="intro-center">
    <div class="intro-logo">974DR</div>
    <div class="intro-sub">Vive la 974DR ¬∑ Vive S√©cheron ‚ú®</div>
    <div class="intro-heart">‚ù§Ô∏è Vive les maths ‚ù§Ô∏è</div>

    <!-- ‚§µÔ∏è Nouveau bouton d‚Äôintro (id diff√©rent du bouton du jeu) -->
    <button id="introStartBtn" class="intro-btn" type="button">
      Table de multiplication
    </button>
  </div>
</div>

  <div class="wrap">
    <header>
      <div class="logo"><span>√ó</span></div>
      <div>
        <h1>Pour les √©l√®ves de la 974DR !</h1>
        <div class="sub">Tables de multiplication ‚Äî entra√Ænement ludique</div>
      </div>
    </header>

    <div class="banner">
      üíô Vive la 974DR ! üíô <br>
      üíö Vive S√©cheron ! üíö <br>
      ‚ù§Ô∏è Vive les maths ‚ù§Ô∏è
    </div>

    <section class="card">
      <div class="grid">
        <div>
          <div class="chip"><input type="radio" name="mode" value="train" checked> Entra√Ænement</div>
          <div class="chip"><label>Nb questions <input id="numQ" type="number" value="10"></label></div>
          <button id="startBtn">D√©marrer</button>
        </div>
        <div>
          <div id="play" class="card" style="display:none">
            <div class="question"><span id="qa"></span> √ó <span id="qb"></span> = ?</div>
            <div class="input-line"><input id="answer" type="number"><button id="okBtn">Valider</button></div>
            <div id="feedback" class="feedback"></div>
            <div class="status">
              <div class="pill">Q <span id="count">0</span></div>
              <div class="pill ok">‚úîÔ∏é <span id="good">0</span></div>
              <div class="pill bad">‚úñÔ∏é <span id="bad">0</span></div>
            </div>
          </div>
          <div id="result" class="result card">
            <h3>R√©sum√©</h3>
            <p>Score : <strong><span id="scorePct">0</span>%</strong></p>
            <button id="againBtn">Refaire</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Feu d'artifice : canevas + son -->
  <audio id="fw-sound" src="fireworks.mp3" preload="auto"></audio>

  <script>
    function closeIntro(){ document.getElementById('intro').classList.add('hide'); }

    // ============ Jeu ============
    let qa=0,qb=0,qCount=0,good=0,bad=0,numQ=10;
    const qaEl=document.getElementById('qa'),
          qbEl=document.getElementById('qb'),
          countEl=document.getElementById('count'),
          goodEl=document.getElementById('good'),
          badEl=document.getElementById('bad'),
          feedback=document.getElementById('feedback');

    function newQ(){
      qa=Math.floor(Math.random()*10)+2;
      qb=Math.floor(Math.random()*11);
      qaEl.textContent=qa; qbEl.textContent=qb;
      document.getElementById('answer').value='';
      document.getElementById('answer').focus();
    }

    function check(){
      const ans=parseInt(document.getElementById('answer').value);
      if(ans===qa*qb){ good++; feedback.textContent='‚úîÔ∏è'; feedback.className='feedback ok'; }
      else { bad++; feedback.textContent=`‚úñÔ∏è (${qa*qb})`; feedback.className='feedback bad'; }
      qCount++; updateUI();
      if(qCount<numQ) newQ(); else end();
    }

    function updateUI(){ countEl.textContent=qCount; goodEl.textContent=good; badEl.textContent=bad; }

    function start(){
      qCount=0; good=0; bad=0; updateUI(); document.getElementById('play').style.display='block';
      document.getElementById('result').style.display='none'; newQ();
    }

    function end(){
      document.getElementById('play').style.display='none';
      document.getElementById('result').style.display='block';
      document.getElementById('scorePct').textContent=Math.round(100*good/qCount)||0;
      showFireworks(4000);
    }

    document.getElementById('startBtn').onclick=start;
    document.getElementById('okBtn').onclick=check;
    document.getElementById('againBtn').onclick=start;

    // ============ Fireworks int√©gr√© ============
    (function () {
      function createCanvas() {
        let canvas=document.getElementById('fireworks-overlay');
        if(!canvas){
          canvas=document.createElement('canvas'); canvas.id='fireworks-overlay';
          canvas.style.position='fixed'; canvas.style.inset='0'; canvas.style.zIndex='10000'; canvas.style.pointerEvents='none';
          document.body.appendChild(canvas);
        }
        const ctx=canvas.getContext('2d');
        canvas.width=window.innerWidth; canvas.height=window.innerHeight;
        return {canvas,ctx};
      }
      class Particle {
        constructor(x,y,color,angle,speed){this.x=x;this.y=y;this.vx=Math.cos(angle)*speed;this.vy=Math.sin(angle)*speed;this.life=1;this.decay=Math.random()*0.015+0.012;this.color=color;this.size=Math.random()*2+1.5;}
        update(){this.x+=this.vx;this.y+=this.vy;this.vy+=0.05;this.vx*=0.99;this.vy*=0.99;this.life-=this.decay;return this.life>0;}
        draw(ctx){ctx.globalAlpha=Math.max(this.life,0);ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=this.color;ctx.fill();}
      }
      function explode(particles,cx,cy){
        const palette=['#ff5252','#ffd166','#6ee7b7','#60a5fa','#a78bfa','#f472b6'];
        const color=palette[(Math.random()*palette.length)|0];
        const count=90;
        for(let i=0;i<count;i++){const angle=Math.random()*Math.PI*2;const speed=(Math.random()*4+2);particles.push(new Particle(cx,cy,color,angle,speed));}
        const a=document.getElementById('fw-sound'); if(a){a.currentTime=0;a.play().catch(()=>{});}
      }
      window.showFireworks=function(duration=4000){
        const {canvas,ctx}=createCanvas(); const particles=[]; const endAt=performance.now()+duration;
        const jitter=()=>({x:canvas.width/2+(Math.random()-0.5)*100,y:canvas.height/2+(Math.random()-0.5)*100});
        explode(particles,canvas.width/2,canvas.height/2);
        function frame(now){
          ctx.globalCompositeOperation='source-over';ctx.globalAlpha=0.18;ctx.fillStyle='#000';ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.globalCompositeOperation='lighter';
          for(let i=particles.length-1;i>=0;i--){const p=particles[i];if(!p.update()){particles.splice(i,1);continue;}p.draw(ctx);}
          if(now<endAt){if(Math.random()<0.08){const c=jitter();explode(particles,c.x,c.y);}requestAnimationFrame(frame);}else if(particles.length){requestAnimationFrame(frame);}else{canvas.remove();}
        }
        requestAnimationFrame(frame);
      }
    })();
  </script>

  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js?v=12').then(r => r.update()).catch(()=>{});
}
</script>
</body>
</html>
